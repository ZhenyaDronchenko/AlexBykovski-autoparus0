{% set isEditAction = isEditAction is defined ? isEditAction : app.request.attributes.get('_route') == "user_profile_product_categories_spare_part_edit_general_advert" %}
{% set scrollToElement = false %}
<form id="form-edit-general-advert" action="{{ advertId and not isEditAction ? path("user_profile_product_categories_spare_part_add_second_part_general_advert", {"id" : advertId}) : path(app.request.attributes.get('_route'), app.request.attributes.get('_route_params')) }}" method="post" novalidate enctype="multipart/form-data"
    {% if isValid %}
        {% if not isConfirmBrand and not isEditAction %}
            redirect-to-url redirect-url="{{ path("user_profile_product_categories_spare_part_edit_general_advert", {'id': advertId}) }}"
        {% elseif isEditAction %}
            redirect-to-url redirect-url="{{ path("user_profile_product_categories_spare_part_list_adverts") }}"
        {% endif %}
    {% endif %}
>
    {{ form_widget(form._token) }}
    <div class="choice-form1">
        <div class="form-reg">
            <fieldset class="mk_choice"
                      {% if not scrollToElement and form.condition.vars.errors.form.getErrors(true) | length %}
                          scroll-to-element
                          {% set scrollToElement = true %}
                      {% endif %}
            >
                {% if isEditAction %}
                    <legend class="profil-title">Состояние запчасти (товара)</legend>
                {% else %}
                    <legend class="profil-title">Укажите состояние предлагаемых Вами запчастей (товаров)</legend>
                {% endif %}
                <ul class="filter-list">
                    {% for choice in form.condition %}
                        <li class="filter-option">
                            {{ form_widget(choice, {attr: {class: "visually-hidden filter-input filter-input-radio" }}) }}
                            {{ form_label(choice) }}
                        </li>
                    {% endfor %}
                </ul>
                {% for key, error in form.condition.vars.errors.form.getErrors(true)%}
                    <span class="check">{{ error.message }}</span>
                {% endfor %}
            </fieldset>

            <fieldset class="mk_choice"
                    {% if not scrollToElement and form.stockType.vars.errors.form.getErrors(true) | length %}
                        scroll-to-element
                        {% set scrollToElement = true %}
                    {% endif %}>
                {% if isEditAction %}
                    <legend class="profil-title">Наличие</legend>
                {% else %}
                    <legend class="profil-title">Отметьте наличие запчастей (товаров)</legend>
                {% endif %}
                <ul class="filter-list">
                    {% for choice in form.stockType %}
                        <li class="filter-option">
                            {{ form_widget(choice, {attr: {class: "visually-hidden filter-input filter-input-radio" }}) }}
                            {{ form_label(choice) }}
                        </li>
                    {% endfor %}
                </ul>
                {% for key, error in form.stockType.vars.errors.form.getErrors(true)%}
                    <span class="check">{{ error.message }}</span>
                {% endfor %}
            </fieldset>
        </div>

        <div class="marka-block"
                {% if not scrollToElement and form.brand.vars.errors.form.getErrors(true) | length %}
                    scroll-to-element
                {% set scrollToElement = true %}
                {% endif %}>
            {% if isEditAction %}
                <h2 class="profil-title">Марка-Модели</h2>
            {% else %}
                <h2 class="profil-title">Выберите марку или условие "Все марки"</h2>
            {% endif %}
            <div class="choice-marka">
                {{ form_widget(form.brand, {attr: {class: "name-select form-brand-select"}}) }}
                {% for key, error in form.brand.vars.errors.form.getErrors(true)%}
                    <span class="check">{{ error.message }}</span>
                {% endfor %}
                <a class="link-help"><img src="/img/help.png" alt="Подсказка"></a>
            </div>
            <div class="podskazka">
                <div class="close">x</div>
                <h2>{{ default_text(4).headline }}</h2>
                {{ default_text(4).text | raw }}
            </div>
        </div>

        <div class="choice-new">
            <fieldset id="model-fieldset" get-models-by-brand brand-select=".form-brand-select"
                      container-model="#model-container" list-models="#list-models" legend-element="#chosen-brand-name"
                    {% if not scrollToElement and form.models.vars.errors.form.getErrors(true) | length %}
                        scroll-to-element
                        {% set scrollToElement = true %}
                    {% endif %}>
                <legend id="chosen-brand-name" class="button" style="display: {{ form.models | length ? 'block' : 'none' }}"><span class="first-span">Отметить все модели</span> <span class="second-span">{{ form.brand.vars.help }}</span></legend>
                {% for key, error in form.models.vars.errors.form.getErrors(true)%}
                    <span class="check">{{ error.message }}</span>
                {% endfor %}
                <ul id="list-models" class="filter-mark">
                    {% for choice in form.models %}
                        <li class="filter-option filter-option--size">
                            {{ form_widget(choice, {attr: {class: "visually-hidden filter-input filter-input-checkbox checkbox model-checkbox" }}) }}
                            {{ form_label(choice) }}
                        </li>
                    {% endfor %}
                </ul>
                <div id="model-container" style="display: none">
                    <li class="filter-option filter-option--size">
                        <input type="checkbox" id="spare_part_general_advert_models___index__" name="spare_part_general_advert[models][]" class="visually-hidden filter-input filter-input-checkbox checkbox">
                        <label for="spare_part_general_advert_models___index__"></label>
                    </li>
                </div>
            </fieldset>
            <div class="block-btn">
                {% if not isEditAction %}
                    {{ form_widget(form.submitGeneral, {attr: {class: "submit-brand-model btn"}}) }}

                    {% if isConfirmBrand %}
                        <span
                                {% if not scrollToElement %}
                                    scroll-to-element
                                {% set scrollToElement = true %}
                                {% endif %}>Подтверждение принято</span>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>

    <div class="choice-form2">
        {% if isEditAction %}
            <b class="profil-title">Отметьте предлагаемые Вами запчасти или товары для выбранных марок-моделей</b>
        {% else %}
            <b class="profil-title">Запчасти, товары для авто</b>
        {% endif %}
        <fieldset
                {% if not scrollToElement and form.spareParts.vars.errors.form.getErrors(true) | length %}
                    scroll-to-element
                    {% set scrollToElement = true %}
                {% endif %}>
            <legend class="button-m button-left">Отметить все запчасти (товары)</legend>
            {% for key, error in form.spareParts.vars.errors.form.getErrors(true)%}
                <span class="check">{{ error.message }}</span>
            {% endfor %}
            <ul class="filter-list">
                {% for choice in form.spareParts %}
                    <li class="filter-option">
                        {{ form_widget(choice, {attr: {class: "visually-hidden filter-input filter-input-checkbox checkbox_cl" }}) }}
                        {{ form_label(choice) }}
                    </li>
                {% endfor %}
            </ul>
        </fieldset>
        <p class="comment">
            <span>Комментарий к группе товаров:</span>
            {{ form_widget(form.comment, {attr: {"rows": "3"}}) }}
        </p>
        <div class="block-btn">
            {{ form_widget(form.submitSparePart, {attr: {class: "btn"}}) }}
            {% if isValid and not isConfirmBrand %}
                <span {% if not scrollToElement and form.spareParts.vars.errors.form.getErrors(true) | length %}
                            scroll-to-element
                            {% set scrollToElement = true %}
                        {% endif %}>Изменения приняты и сохранены</span>
            {% endif %}
        </div>
    </div>
</form>